[root@dev-infra4-ifc1 jalaja]# ls
Dockerfile  script
[root@dev-infra4-ifc1 jalaja]# cat Dockerfile
FROM dockerhub.cisco.com/atom-docker/elastic:0.1.8 --->change the version accordingly
   COPY script /tmp/script
   ENTRYPOINT ["/tmp/script"]
   CMD ["daemonize"]
[root@dev-infra4-ifc1 jalaja]# cat script
#!/bin/bash -x

/usr/bin/start_es.sh
while true;
 do sleep 100000;
done
[root@dev-infra4-ifc1 jalaja]#      
[root@dev-infra4-ifc1 jalaja]# docker build -t es .
Sending build context to Docker daemon 3.072 kB
Step 1 : FROM dockerhub.cisco.com/atom-docker/elastic:0.1.8
 ---> 3c7abe8155cf
Step 2 : COPY script /tmp/script
 ---> 77cb4dee764c
Removing intermediate container 7d0d02f52057
Step 3 : ENTRYPOINT /tmp/script
 ---> Running in 3dc3034c14e0
 ---> 20a948e2f99a
Removing intermediate container 3dc3034c14e0
Step 4 : CMD daemonize
 ---> Running in f6b1b8bd1b1d
 ---> bbbf6b9b4cef
Removing intermediate container f6b1b8bd1b1d
Successfully built bbbf6b9b4cef

root@dev-infra4-ifc1 jalaja]# docker run -it es sh
[root@dev-infra4-ifc1 jalaja]# docker run -it es /bin/bash
+ /usr/bin/start_es.sh
+ export 'ES_JAVA_OPTS=-Xms1g -Xmx1g'
+ ES_JAVA_OPTS='-Xms1g -Xmx1g'
+ export ELASTIC_HOST_PATH=/etc/systemd/elastic.conf
+ ELASTIC_HOST_PATH=/etc/systemd/elastic.conf
+ echo 192.168.122.6,192.168.122.7,192.168.122.8
++ cat /etc/systemd/elastic.conf
+ export UNICAST_HOSTS=192.168.122.6,192.168.122.7,192.168.122.8
+ UNICAST_HOSTS=192.168.122.6,192.168.122.7,192.168.122.8
+ ulimit -n 65536
+ cd /usr/share/elasticsearch
+ export LD_LIBRARY_PATH=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64/jre/lib/ext
+ LD_LIBRARY_PATH=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64/jre/lib/ext
+ echo /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64/jre/lib/ext
/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64/jre/lib/ext
+ env cluster.name=elastic-cluster discovery.zen.ping.unicast.hosts=192.168.122.6,192.168.122.7,192.168.122.8 bootstrap.system_call_filter=false SYSTEMCTL_SKIP_REDIRECT=1 su -c '/bin/bash -x /etc/init.d/elasticsearch start'
+ '[' -f /etc/rc.status ']'
+ '[' -f /etc/rc.d/init.d/functions ']'
+ . /etc/rc.d/init.d/functions
++ TEXTDOMAIN=initscripts
++ umask 022
++ PATH=/sbin:/usr/sbin:/bin:/usr/bin
++ export PATH
++ '[' 9 -ne 1 -a -z 1 ']'
++ '[' -z '' ']'
++ COLUMNS=80
++ '[' -z '' ']'
++ '[' -c /dev/stderr -a -r /dev/stderr ']'
+++ /sbin/consoletype
++ CONSOLETYPE=pty
++ '[' -z '' ']'
++ '[' -z '' ']'
++ '[' -f /etc/sysconfig/i18n -o -f /etc/locale.conf ']'
++ . /etc/profile.d/lang.sh
++ unset LANGSH_SOURCED
++ '[' -z '' ']'
++ '[' -f /etc/sysconfig/init ']'
++ . /etc/sysconfig/init
+++ BOOTUP=color
+++ RES_COL=60
+++ MOVE_TO_COL='echo -en \033[60G'
+++ SETCOLOR_SUCCESS='echo -en \033[0;32m'
+++ SETCOLOR_FAILURE='echo -en \033[0;31m'
+++ SETCOLOR_WARNING='echo -en \033[0;33m'
+++ SETCOLOR_NORMAL='echo -en \033[0;39m'
++ '[' pty = serial ']'
++ __sed_discard_ignored_files='/\(~\|\.bak\|\.orig\|\.rpmnew\|\.rpmorig\|\.rpmsave\)$/d'
++ '[' '' = 1 ']'
+++ cat /proc/cmdline
++ strstr 'ro root=/dev/mapper/luks-6fa6b481-45bf-42aa-a5a9-583cbcba4e69 rd_LUKS_UUID=luks-6fa6b481-45bf-42aa-a5a9-583cbcba4e69 LANG=en_US.UTF-8 SYSFONT=latarcyrheb-sun16 rd.lvm.lv=vg_ifc0/rfs1 rd.lvm.lv=vg_ifc0/firmware rd.lvm.lv=vg_ifc0/techsupport rd.lvm.lv=vg_ifc0/data2 rd.lvm.lv=vg_ifc0/dmecores rd.lvm.lv=vg_ifc0/scratch rd.lvm.lv=vg_ifc0_ssd/data rd.lvm.lv=vg_ifc0/logs KEYBOARDTYPE=pc KEYTABLE=us crashkernel=256M rhgb quiet selinux=0 audit=1 console=ttyS0,115200 console=tty0 cgroup_enable=memory tpm_tis.interrupts=0' rc.debug
++ '[' 'ro root=/dev/mapper/luks-6fa6b481-45bf-42aa-a5a9-583cbcba4e69 rd_LUKS_UUID=luks-6fa6b481-45bf-42aa-a5a9-583cbcba4e69 LANG=en_US.UTF-8 SYSFONT=latarcyrheb-sun16 rd.lvm.lv=vg_ifc0/rfs1 rd.lvm.lv=vg_ifc0/firmware rd.lvm.lv=vg_ifc0/techsupport rd.lvm.lv=vg_ifc0/data2 rd.lvm.lv=vg_ifc0/dmecores rd.lvm.lv=vg_ifc0/scratch rd.lvm.lv=vg_ifc0_ssd/data rd.lvm.lv=vg_ifc0/logs KEYBOARDTYPE=pc KEYTABLE=us crashkernel=256M rhgb quiet selinux=0 audit=1 console=ttyS0,115200 console=tty0 cgroup_enable=memory tpm_tis.interrupts=0' = 'ro root=/dev/mapper/luks-6fa6b481-45bf-42aa-a5a9-583cbcba4e69 rd_LUKS_UUID=luks-6fa6b481-45bf-42aa-a5a9-583cbcba4e69 LANG=en_US.UTF-8 SYSFONT=latarcyrheb-sun16 rd.lvm.lv=vg_ifc0/rfs1 rd.lvm.lv=vg_ifc0/firmware rd.lvm.lv=vg_ifc0/techsupport rd.lvm.lv=vg_ifc0/data2 rd.lvm.lv=vg_ifc0/dmecores rd.lvm.lv=vg_ifc0/scratch rd.lvm.lv=vg_ifc0_ssd/data rd.lvm.lv=vg_ifc0/logs KEYBOARDTYPE=pc KEYTABLE=us crashkernel=256M rhgb quiet selinux=0 audit=1 console=ttyS0,115200 console=tty0 cgroup_enable=memory tpm_tis.interrupts=0' ']'
++ return 1
++ return 0
+ ES_USER=elasticsearch
+ ES_GROUP=elasticsearch
+ ES_HOME=/usr/share/elasticsearch
+ MAX_OPEN_FILES=65536
+ MAX_MAP_COUNT=262144
+ LOG_DIR=/var/log/elasticsearch
+ DATA_DIR=/var/lib/elasticsearch
+ CONF_DIR=/etc/elasticsearch
+ PID_DIR=/var/run/elasticsearch
+ ES_ENV_FILE=/etc/sysconfig/elasticsearch
+ '[' -f /etc/sysconfig/elasticsearch ']'
+ . /etc/sysconfig/elasticsearch
++ ES_STARTUP_SLEEP_TIME=5
+ '[' elasticsearch '!=' elasticsearch ']'
+ '[' elasticsearch '!=' elasticsearch ']'
+ '[' '!' -z '' ']'
+ exec=/usr/share/elasticsearch/bin/elasticsearch
+ prog=elasticsearch
+ pidfile=/var/run/elasticsearch/elasticsearch.pid
+ export ES_JAVA_OPTS
+ export JAVA_HOME
+ export ES_INCLUDE
+ export ES_JVM_OPTIONS
+ export ES_STARTUP_SLEEP_TIME
+ test -n ''
+ test -n ''
+ test -n ''
+ test -n ''
+ test -n ''
+ test -n ''
+ test -n ''
+ test -n ''
+ lockfile=/var/lock/subsys/elasticsearch
+ '[' -n ']'
+ '[' -z elasticsearch ']'
+ '[' '!' -x /usr/share/elasticsearch/bin/elasticsearch ']'
+ case "$1" in
+ rh_status_q
+ rh_status
+ start
+ checkJava
+ '[' -x /bin/java ']'
+ JAVA=/bin/java
+ '[' '!' -x /bin/java ']'
+ '[' -x /usr/share/elasticsearch/bin/elasticsearch ']'
+ '[' -n 65536 ']'
+ ulimit -n 65536
+ '[' -n '' ']'
+ '[' -n 262144 -a -f /proc/sys/vm/max_map_count ']'
+ sysctl -q -w vm.max_map_count=262144
sysctl: setting key "vm.max_map_count": Read-only file system
+ '[' -n /var/run/elasticsearch ']'
+ '[' '!' -e /var/run/elasticsearch ']'
+ '[' -n /var/run/elasticsearch/elasticsearch.pid ']'
+ '[' '!' -e /var/run/elasticsearch/elasticsearch.pid ']'
+ touch /var/run/elasticsearch/elasticsearch.pid
+ chown elasticsearch:elasticsearch /var/run/elasticsearch/elasticsearch.pid
+ cd /usr/share/elasticsearch
+ echo -n 'Starting elasticsearch: '
Starting elasticsearch: + daemon --user elasticsearch --pidfile /var/run/elasticsearch/elasticsearch.pid /usr/share/elasticsearch/bin/elasticsearch -p /var/run/elasticsearch/elasticsearch.pid -d -Edefault.path.logs=/var/log/elasticsearch -Edefault.path.data=/var/lib/elasticsearch -Edefault.path.conf=/etc/elasticsearch
+ local gotbase= force= nicelevel corelimit
+ local pid base= user= nice= bg= pid_file=
+ local cgroup=
+ nicelevel=0
+ '[' --user '!=' -user ']'
+ case $1 in
+ user=elasticsearch
+ shift 2
+ '[' --pidfile '!=' -pidfile ']'
+ case $1 in
+ pid_file=/var/run/elasticsearch/elasticsearch.pid
+ shift 2
+ '[' /usr/share/elasticsearch/bin/elasticsearch '!=' /usr/share/elasticsearch/bin/elasticsearch ']'
+ '[' -z '' ']'
+ base=elasticsearch
+ __pids_var_run elasticsearch /var/run/elasticsearch/elasticsearch.pid
+ local base=elasticsearch
+ local pid_file=/var/run/elasticsearch/elasticsearch.pid
++ /usr/bin/dirname /var/run/elasticsearch/elasticsearch.pid
+ local pid_dir=
+ local binary=
+ '[' -d '' -a '!' -r '' ']'
+ pid=
+ '[' -f /var/run/elasticsearch/elasticsearch.pid ']'
+ local line p
+ '[' '!' -r /var/run/elasticsearch/elasticsearch.pid ']'
+ :
+ read line
+ '[' -z '' ']'
+ break
+ '[' -n '' ']'
+ return 1
+ '[' -n '' -a -z '' ']'
+ corelimit='ulimit -S -c 0'
+ '[' -n '' ']'
+ '[' -n '' ']'
+ '[' color = verbose -a -z '' ']'
+ '[' -z elasticsearch ']'
+ runuser -s /bin/bash elasticsearch -c 'ulimit -S -c 0 >/dev/null 2>&1 ; /usr/share/elasticsearch/bin/elasticsearch -p /var/run/elasticsearch/elasticsearch.pid -d -Edefault.path.logs=/var/log/elasticsearch -Edefault.path.data=/var/lib/elasticsearch -Edefault.path.conf=/etc/elasticsearch'
[main] INFO com.cisco.ciscossl.provider.ciscojce.CiscoJCEProvider - static - env variable CISCOJ_NON_FIPS_OPERATION not set
[main] INFO com.cisco.ciscossl.provider.ciscojce.CiscoJCEProvider - static - java.security setting "com.cisco.ciscossl.provider.ciscojce.enableCommonCriteriaAtStartup"= null
[main] INFO com.cisco.ciscossl.provider.ciscojce.CiscoJCEProvider - static - java.security setting "com.cisco.ciscossl.provider.ciscojce.enableCommonCriteriaAtStartup" not set; defaulting to disabled
[main] INFO com.cisco.ciscossl.provider.ciscojce.CiscoJCEProvider - static - java.security setting "com.cisco.ciscossl.provider.ciscojce.enableFipsAtStartup"= true
[main] INFO com.cisco.ciscossl.provider.ciscojce.CiscoJCEProvider - static - java.security setting "com.cisco.ciscossl.provider.ciscojce.rsaPublicExponentDefault"= null
[main] INFO com.cisco.ciscossl.provider.ciscojce.CiscoJCEProvider - setFipsEnabled - Enabling FIPS mode.
[main] INFO com.cisco.ciscossl.provider.ciscojce.CiscoJCEProvider - run - CiscoJCEProvider version 4.1.6.2017-09-06-19-29-59 loading...
[main] INFO com.cisco.ciscossl.provider.ciscojce.CiscoJCEProvider - run - CiscoJCEProvider - CiscoJCEProvider version 4.001006 loading...
[main] INFO com.cisco.ciscossl.provider.ciscojce.CiscoJCEProvider - run - Library: CiscoSSL 1.0.2n.6.2.194-fips loading...
[main] INFO com.cisco.ciscossl.provider.ciscojce.CiscoJCEProvider - run - LD_LIBRARY_PATH env var: /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.161-0.b14.el7_4.x86_64/jre/lib/ext
[main] INFO com.cisco.ciscossl.provider.ciscojce.CiscoJCEProvider - run - Executing Java version = 1.8.0_161
+ '[' 0 -eq 0 ']'
+ success 'elasticsearch startup'
+ '[' color '!=' verbose -a -z '' ']'
+ echo_success
+ '[' color = color ']'
+ echo -en '\033[60G'
                                                           + echo -n '['
[+ '[' color = color ']'
+ echo -en '\033[0;32m'
+ echo -n '  OK  '
  OK  + '[' color = color ']'
+ echo -en '\033[0;39m'
+ echo -n ']'
]+ echo -ne '\r'
+ return 0
+ return 0
+ retval=0
+ echo

+ '[' 0 -eq 0 ']'
+ touch /var/lock/subsys/elasticsearch
+ return 0
+ exit 0
+ sleep 100000
